{
    "componentChunkName": "component---src-pages-markdown-remark-frontmatter-slug-js",
    "path": "/post/7/",
    "result": {"data":{"markdownRemark":{"html":"<h1>자바스크립트의 비동기 처리 방식</h1>\n<p>닳고 닳은 코드이지만... 아래 코드를 봅시다.</p>\n<pre><code class=\"language-javascript\">console.log('1');\r\n\r\nsetTimeout(() => {\r\n  console.log('2');\r\n}, 0);\r\n\r\nconsole.log('3');\n</code></pre>\n<p>비동기에 대한 이해가 없으실 경우, 예측 결과는 1, 2, 3입니다. 하지만 실제 결과는 이렇습니다.</p>\n<p><img src=\"/11cc813ab8d77d10f537891152c893c4/post-7-1.png\" alt=\"결과\"></p>\n<p>어떻게 이런 일이 발생한 걸까요?</p>\n<p>이는 setTimeout이 비동기API이기 때문입니다.\r\n이처럼 자바스크립트는 비동기코드를 만날 경우 평소와 다르게 작동합니다.</p>\n<h2>비동기 코드의 작동 순서</h2>\n<p>비동기API가 포함된 코드는 이렇게 작동합니다.</p>\n<ol>\n<li>비동기 코드가 아닌 코드를 순서대로 실행합니다.</li>\n<li>비동기 API를 만났습니다.</li>\n<li>비동기 API의 실행을 나중으로 미룹니다.</li>\n<li>나머지 코드를 실행 시킵니다.</li>\n<li>미뤄두었던 비동기 코드를 실행합니다.</li>\n</ol>\n<p>즉, 비동기API는 다른 코드가 실행된 후 마지막에 실행되기 때문에 위와 같은 결과가 나올 수 있었습니다.</p>\n<p>여기까지의 내용은 자바스크립트를 자주 다뤄오신 분들이라면 이미 아는 내용이실거고, 이해하기 쉬운 내용입니다.</p>\n<p>저는 여기서 <strong>구체적으로 어떤 과정을 통해</strong> 이런 작동을 하는지 궁금했습니다. 이글은 이에 대해 알아보고 정리한 글입니다.</p>\n<h2>자바스크립트 엔진의 구조</h2>\n<p>자바스크립트는 브라우저에서 돌아갑니다. 브라우저는 자바스크립트 코드를 해석하고 실행하기 위해 자바스크립트 엔진을 탑재하고 있습니다. 아마 V8엔진같은 말을 들어 보셨을겁니다.</p>\n<p>브라우저는 이 자바스크립트 엔진을 이용하여 코드를 해석하고, 실행한다는 것이죠.</p>\n<p>비동기 코드가 어떻게 처리되는가. 이것을 알아보려면 자바스크립트 엔진의 구조와 작동 방식을 뜯어보아야 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 762px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ce63bf9d5767f288b887bf496fa5ab0/a016c/post-7-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACmUlEQVQoz02RXUhTARTHT6nkQ1hZUS8Z9BCM6KWwepaQBhYz3abzbspcQVDI8KHZQwTLDxSFnOiUdsedEiJedgc6SJk9tAk5/LghzrtIcXcfXq0la9pyu/fE5oT+cA6HA+fH/5wDTQZDZTAaNbIrKyb/4qLeaDReXVpaes6y7MvV1dUXcrn8FgAUwJFOZJOyQaiq0+09U2vjzWrtT0Odbs+g1safVqu+X4FP09Nv05ubmJWUTidCPP8I/5PL5WpARCgru3YJAK4DQLGmaX+F0Gewpp7Hx+pN1DTtI6E/xFpNVAGzU1PmDM9jMhDA317v9rd4vDqTTh9IkiQhYnpyclKbBSJizl22rq0Py9TEj3sqYrdcRezeyUWDcFeh5M7AnNdrRlHE5PIySog73NqaQhTF1BEPRZqmj4FwDKyp50HTmARtswiE/hC0zRlQEbugUHIALoYxh7a2kI/FMBKJ7IQjkepEIpHa2NjAZDIpud1uIg8sdLlcYHtvhddvpou+LGJBvn8y697c8bXoncVZAJ65OXPufqKIkiTtsCyr4Hk+FQ6HMRaLiQ6HI+fQ4/GAIAgwOjoK/f39+R/BaQAoAoBTDMPA2NgYwEeG6fgTCKCYB/p8vlqfz5ean5/HhYUF7O3tVc3MzMg5jvvg9/sv9/T0lE5MTFT29fU9aG1tlXd3d9eZTKYqh8NRMT4+fh8+z86+QkE4fup2KBSq4DjuMBgMYnbt7CDLsnQ0GkWapomWlhYlRVF/7XY7R1GUm6KoA7vd7iNJMkxR1C+4VV7+kKRp3dDQ0JOuri61TCa7abVatSRJGmw2W2NJSclthmFurK+v65xOZ3FbW1vhyMjIBYvFUtre3n52YGDgYmdn57nBwcHS4eHh8/8At8q7noIvuAEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"자바스크립트엔진구조\"\n        title=\"자바스크립트엔진구조\"\n        src=\"/static/4ce63bf9d5767f288b887bf496fa5ab0/a016c/post-7-2.png\"\n        srcset=\"/static/4ce63bf9d5767f288b887bf496fa5ab0/772e8/post-7-2.png 200w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/e17e5/post-7-2.png 400w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/a016c/post-7-2.png 762w\"\n        sizes=\"(max-width: 762px) 100vw, 762px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>간단하게 그려진 자바스크립트 엔진의 구조입니다.\r\n메모리 힙을 제외한 요소들을 하나씩, 간단하게, <strong>비동기 코드 처리를 어떻게 하는지</strong>에 초점을 맞춰서 정리해보겠습니다.</p>\n<h2>콜 스택(Call Stack)</h2>\n<p>코드가 실행될 호출 스택입니다. LIFO(Last In, First Out) 후입선출이라고도 하는 구조를 갖고 있습니다.\r\n자바스크립트는 콜 스택을 하나만 가지고 있습니다. 즉, 싱글 스레드라는 뜻입니다. 한 번에 하나의 일만 진행할 수 있다는 의미입니다.</p>\n<p>저처럼 호출 스택이란 단어를 처음 접하셨다면 단어가 생소하실지도 모르겠습니다. 호출 스택이란 간단히 말해서 프로그램을 실행하며 만나게되는 여러 함수(Function)의 실행 순서를 의미합니다. 다음과 같은 간단한 코드를 보고, 콜 스택에 어떻게 담기게 될지 예측해보는 시간을 가져보겠습니다.</p>\n<pre><code class=\"language-javascript\">function foo() {\r\n  console.log('foo');\r\n}\r\nfunction bar() {\r\n  foo();\r\n}\r\n\r\nbar();\n</code></pre>\n<p>이 코드를 보고 저희가 예상할 수 있는 순서는 다음과 같습니다.</p>\n<ol>\n<li>bar 호출.</li>\n<li>foo 호출.</li>\n<li>console.log('foo'); 를 실행</li>\n</ol>\n<p>네, 이와 같은 순서가 콜 스택에서 진행됩니다.\r\n위 코드가 콜스택에서 어떤 동작을 하는지 살펴보겠습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0338d038144117ece0807c21596a6d2f/bad1b/post-7-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1klEQVQozz2RTYvTQBjHH8SDB1HQwxbFdbW7ICh+KF8OviAifoTe+hV6a8HDLsoq9NBToW9QCG2mmSRNS9sUQttLSVsykzg788izZB0YMv95nv9v/jOByWQCy+US6IuIEAQBhGEI8/kcttstVKvV630AOAKAEwC4U6/Xr2vUSzXykmexWAAwxorj8fiUMXZMRdu2j3zfP3Ndt9hoNG5blnWP9Gq1eo6Id6MousU5J8+ZbdsF8jDGnvi+f+p5XhGEEAIRUUrJKEaSJD+MMaiUkp7nncRx/EYpRRrjOP5gWdYjpZSgHiHEBXmklBZprXUCWZYRD7MsC+i0NE0vSGutcbPZPJVSvqM1TSnlp/V6XaA1jTRN/5AnyzIH80GAqxzoAcD9w+Hwk7Qx5qpWq72azWZfco1RFH0rl8svjDF/aU8IcUkeIYRz4yG6zoE+ADzc7Xa/8oS6Uqm8DoLgK8FohmH4vVQqvURElQN/A8ADIQTPgZreUFNzkiQEBNd1z3u9Hg6HQ7Pf748552+73S52Oh20bfsjIhYoBF2bEqZpSqHY/4SMMd1ut3E0Gvn5Xz5vNpvY7/fNdDp9xjl/32q1kHocx/kcBMHjwWCg6RDO+SV5pJSjG+A/1sfv0iy5ZEkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"콜스택순서\"\n        title=\"콜스택순서\"\n        src=\"/static/0338d038144117ece0807c21596a6d2f/5a190/post-7-3.png\"\n        srcset=\"/static/0338d038144117ece0807c21596a6d2f/772e8/post-7-3.png 200w,\n/static/0338d038144117ece0807c21596a6d2f/e17e5/post-7-3.png 400w,\n/static/0338d038144117ece0807c21596a6d2f/5a190/post-7-3.png 800w,\n/static/0338d038144117ece0807c21596a6d2f/bad1b/post-7-3.png 841w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>콜 스택 내부에서도 저희가 예측한 순서대로 진행됩니다.</p>\n<p>이런 코드는 어떻게 될까요?</p>\n<pre><code class=\"language-javascript\">function foo() {\r\n  foo();\r\n}\r\nfoo();\n</code></pre>\n<p>이 코드는 foo함수를 무한하게 부르게 됩니다. 콜 스택에도 한계가 있기 때문에 이런 경우엔 오류를 발생시킵니다. 그 유명한 Stack Overflow 입니다.</p>\n<h2>Web APIs</h2>\n<p>자바스크립트 엔진이 아닌 브라우저가 내장한 API입니다. 대표적으로 setTimeout, Event Handler, Ajax등이 있습니다.</p>\n<p>비동기 코드를 발견하면 자바스크립트 엔진은 Web API를 호출합니다. Web APIs는 비동기 함수를 콜 스택에서 끌고와 콜 스택과 별개로, 따로 실행 시킵니다. 자바스크립트는 싱글 스레드이지만, 멀티 스레드처럼 작동할 수 있도록 돕는 것이 바로 이 친구였습니다.</p>\n<p>Web APIs는 비동기 코드를 실행한 뒤, 콜백 함수를 콜백 큐로 집어넣습니다.</p>\n<h2>콜백 큐 (Callback Queue)</h2>\n<p>비동기코드가 실행된 후 마무리로 실행되어야 할 콜백 함수가 머무는 곳입니다. 콜 스택은 아랑곳 하지 않고 코드를 계속 실행시킵니다. 콜백 큐에 있는 함수들은 콜 스택이 모든 일을 마칠 때까지 기다립니다.</p>\n<h2>이벤트 루프(Event Loop)</h2>\n<p>이벤트 루프는 콜 스택과 콜백 큐를 관찰합니다. 콜 스택이 모든 일을 마치면 콜백 큐에 있는 태스크가 스택으로 옮겨질 수 있도록 돕는 역할을 합니다.</p>\n<p>네, 스택이 비동기 콜백함수를 제외한 모든 일을 마치고 나서야 이벤트 루프는 콜백 큐에 있는 태스크를 스택으로 다시 옮겨주게 됩니다.</p>\n<p>정리하면 이렇습니다.</p>\n<ol>\n<li>자바스크립트 엔진은 코드를 읽으며 실행 순서를 콜 스택에 쌓아갑니다.</li>\n<li>코드를 읽던 도중 비동기 처리가 필요한 코드를 만나면 Web APIs에게 주도권을 넘깁니다.</li>\n<li>Web APIs는 비동기 코드를 콜 스택에서 끌어와 따로 실행합니다. (가령 setTimeout이라면 카운트를 콜 스택과 별개로 진행합니다.)</li>\n<li>콜백 함수를 콜백 큐로 옮깁니다.</li>\n<li>콜백 큐에 있는 실행 컨텍스트들은 콜 스택이 모든 일을 마칠때까지 기다립니다.</li>\n<li>이벤트 루프가 콜 스택이 비었음을 확인하면, 콜백 큐의 실행 컨텍스트들이 마침내 콜 스택으로 옮겨집니다.</li>\n<li>마지막으로 콜백 함수가 실행됩니다.</li>\n</ol>\n<p>비동기 처리가 어떻게 진행되는지 알아보려다가 브라우저를 뜯어보게 되었는데요.\r\n저는 정말 간단하게 정리했을 뿐이고, 다른 분들의 글을 보면 더 상세한 설명을 보실 수 있을겁니다. 그 중에서도 <a href=\"https://d2.naver.com/helloworld/59361\">브라우저는 어떻게 동작하는가?</a>라는 글을 추천드립니다.</p>\n<p>지적은 감사하게 받고 있습니다. 틀린점이 있다면 댓글로 남겨주세요.\r\n부족한 글 읽어주셔서 감사합니다.</p>","frontmatter":{"date":"November 15, 2021","slug":"post/7","title":"Javascript - 자바스크립트의 비동기 처리 방식","summary":"자바스크립트는 브라우저에서 돌아갑니다. 브라우저는 자바스크립트 코드를 해석하고 실행하기 위해 자바스크립트 엔진을 탑재하고 있습니다. 아마 V8엔진같은 말을 들어 보셨을겁니다.","categories":["Javascript"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/4ce63bf9d5767f288b887bf496fa5ab0/1e010/post-7-2.png","srcSet":"/static/4ce63bf9d5767f288b887bf496fa5ab0/7a5b8/post-7-2.png 28w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/4c483/post-7-2.png 55w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/1e010/post-7-2.png 110w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/43be6/post-7-2.png 220w","sizes":"(min-width: 110px) 110px, 100vw"},"sources":[{"srcSet":"/static/4ce63bf9d5767f288b887bf496fa5ab0/629a0/post-7-2.webp 28w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/938d3/post-7-2.webp 55w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/8c6ff/post-7-2.webp 110w,\n/static/4ce63bf9d5767f288b887bf496fa5ab0/4c27b/post-7-2.webp 220w","type":"image/webp","sizes":"(min-width: 110px) 110px, 100vw"}]},"width":110,"height":110}}}}},"allMarkdownRemark":{"edges":[{"node":{"id":"5b280529-fd84-5a85-8b9f-9923c201877c","frontmatter":{"slug":"post/7","categories":["Javascript"]}}},{"node":{"id":"34a4798d-64e7-5122-bd17-24ca20054faa","frontmatter":{"slug":"post/6","categories":["Algorithm","Java"]}}},{"node":{"id":"4a604184-bb0f-575c-979e-a7785f18c62b","frontmatter":{"slug":"post/5","categories":["Algorithm","Java"]}}},{"node":{"id":"7e9ff073-14a6-5b47-8908-33cc3e702baf","frontmatter":{"slug":"post/4","categories":["Algorithm"]}}},{"node":{"id":"3c3aef0f-8477-52a1-a098-18b992666a28","frontmatter":{"slug":"post/3","categories":["Javascript"]}}},{"node":{"id":"6b375d7d-60df-5b11-9328-35edb730acf5","frontmatter":{"slug":"post/2","categories":["React"]}}},{"node":{"id":"ac36c884-43da-5aec-b185-c96d412349cc","frontmatter":{"slug":"post/1","categories":["Javascript"]}}}]}},"pageContext":{"id":"5b280529-fd84-5a85-8b9f-9923c201877c","frontmatter__slug":"post/7","__params":{"frontmatter__slug":"post"}}},
    "staticQueryHashes": ["2721053520"]}